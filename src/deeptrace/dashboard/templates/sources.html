<div class="section-header">
  <h1 class="section-title">Sources</h1>
  <button class="btn btn-primary" aria-expanded="false" aria-controls="add-source-form" onclick="var f=document.getElementById('add-source-form'); var show=f.style.display==='none'; f.style.display=show?'block':'none'; this.setAttribute('aria-expanded', show)">+ Add Source</button>
</div>

<div id="add-source-form" class="add-form-container" style="display:none">
  <form class="add-form" hx-post="/sources" hx-target="#main-content" hx-swap="innerHTML">
    <div class="form-row">
      <div class="form-group">
        <label for="source-type">Source Type</label>
        <select name="source_type" id="source-type">
          <option value="news">News</option>
          <option value="official">Official</option>
          <option value="social">Social</option>
          <option value="document">Document</option>
          <option value="manual" selected>Manual</option>
        </select>
      </div>
      <div class="form-group">
        <label for="source-url">URL</label>
        <input type="text" name="url" id="source-url" placeholder="https://...">
      </div>
      <div class="form-group" style="max-width:120px">
        <label for="source-reliability">Reliability</label>
        <input type="number" name="reliability_score" id="source-reliability" value="0.5" min="0" max="1" step="0.1">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label for="source-raw-text">Text / Summary</label>
        <textarea name="raw_text" id="source-raw-text" rows="3" required placeholder="Source text or summary..."></textarea>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label for="source-notes">Notes</label>
        <input type="text" name="notes" id="source-notes" placeholder="Optional notes">
      </div>
    </div>
    <div class="flex gap-8">
      <button type="submit" class="btn btn-primary">Add Source</button>
      <button type="button" class="btn btn-ghost" onclick="document.getElementById('add-source-form').style.display='none'">Cancel</button>
    </div>
  </form>
</div>

<div class="panel">
  <table class="data-table">
    <thead>
      <tr>
        <th scope="col" class="id-col">#</th>
        <th scope="col" class="type-col">Type</th>
        <th scope="col">Text</th>
        <th scope="col" style="width:80px">Reliability</th>
        <th scope="col" style="width:100px">Date</th>
      </tr>
    </thead>
    <tbody>
      {% for s in sources %}
      <tr hx-get="/sources/{{ s.id }}" hx-target="#detail-panel" hx-swap="innerHTML" tabindex="0">
        <td class="id-col">{{ s.id }}</td>
        <td class="type-col"><span class="badge">{{ s.source_type }}</span></td>
        <td class="text-truncate" style="max-width:400px">{{ s.raw_text[:100] }}{% if s.raw_text|length > 100 %}...{% endif %}</td>
        <td>{{ "%.1f"|format(s.reliability_score) }}</td>
        <td style="color:var(--text-dim);font-size:12px">{{ s.ingested_at[:10] if s.ingested_at else '' }}</td>
      </tr>
      {% endfor %}
      {% if not sources %}
      <tr><td colspan="5" style="color:var(--text-dim);text-align:center;padding:20px">No sources yet.</td></tr>
      {% endif %}
    </tbody>
  </table>
</div>
